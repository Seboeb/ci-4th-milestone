{% extends 'base.html' %}

{% load static %}

{% block page_title %}Dashboard - The Tasting Experience{% endblock %}

{% block main_content %}
<div class="container content dev-panel">

  <!-- Main panel -->
  <main>
    <!-- Header with controls -->
    <div class="controls">
      <button class="active">Finder app</button>
      <button>Recipe community</button>
      <input type="text" placeholder="Bugs, features, user...">
    </div>

    <!-- Ticket list -->
    <div class="list">

      {% for ticket in tickets %}
      <div class="ticket-list-item" onclick="location.href='{% url 'ticket_view' id=ticket.id %}';">
        {% if ticket.ticket_type.name == "bug_report" %}
        <img src="{% static 'img/bug-report-red.svg' %}" alt="bug_report">
        {% else %}
        <img src="{% static 'img/develop-feature2-blue.svg' %}" alt="feature_request">
        {% endif %}
        <p class="title">{{ ticket.title }}</p>
        <p class="subtitle">{{ ticket.ticket_id }} opened at {{ ticket.date_created|date:"M d, Y" }} by
          {{ ticket.user }}</p>
        <div class="icons">
          <div class="icon">
            <span>{{ ticket.nr_comments }}</span>
            <img src="{% static 'img/comment3.svg' %}" alt="comments">
          </div>
          <div class="icon">
            <span>{{ ticket.upvotes }}</span>
            <img src="{% static 'img/up-vote.svg' %}" alt="upvote">
          </div>
          <!-- <img src="{% static 'img/eye-filled.svg' %}" alt="add to watchlist"> -->
        </div>
      </div>
      {% endfor %}

      <!-- Extend list -->
      <div class="load-more">
        <div>
          <img src="{% static 'img/arrow-down.svg' %}" alt="load more">
          <span>show more</span>
        </div>
      </div>

    </div>
  </main>

  <!-- Dashboard panel -->
  <section class="dashboard-card">
    <div class="main">
      {% if not user.is_authenticated %}
      <p style="font-size:0.8rem;"><a href="{% url 'login' %}">Login</a> to activated your dashboard.</p>
      {% else %}
      <div class="profile-card">
        <div class="avatar">
          <img src="{% static 'img/sebastiaan.svg' %}" alt="Sebastiaan Hekner">
          <a href="">Edit profile</a>
        </div>
        <div class="personal">
          <span class="name">{{ user }}</span>
          <p>{{ user.role }}</p>
        </div>
      </div>
      <div class="ruler"></div>
      <button onclick="TE.openModal('new_feature')">New feature request</button>
      <button onclick="TE.openModal('new_bug_report')">New bug report</button>
      <button>Show reporting</button>
      {% endif %}
    </div>

    {% if user.is_authenticated %}
    <div class="details">
      <div class="summary">
        <p>{{ user_summary.nr_bugs }} Bugs</p>
        <p>{{ user_summary.nr_features }} Features</p>
        <p>!!! Donations</p>
      </div>
      <div class="ruler"></div>
      <div class="tickets-created-list">
        {% for ticket in created_tickets %}
        <a href="{% url 'ticket_view' id=ticket.id %}">
          <div class="created-list-item">
            <span>{{ ticket.ticket_id }}</span>
            <p>{{ ticket.description|truncatechars:35 }}</p>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </section>

  <!-- Watchlist panel -->
  {% if user.is_authenticated %}
  <section class="watchlist-card">
    {% for ticket in watchlist %}
    <a href="{% url 'ticket_view' id=ticket.id %}">
      <div class="watchlist-item">
        <span>{{ ticket.ticket_id }}</span>
        <p>{{ ticket.description|truncatechars:40 }}</p>
      </div>
    </a>
    {% endfor %}
  </section>
  {% endif %}
  <section> </section>

</div>

<div id="new_feature" class="modal-container">
  <div class="modal">
    <img src="{% static 'img/clear.svg' %}" alt="close" class="close-modal" onclick="TE.closeModal('new_feature')">
    <h3>Request a new feature</h3>
    <p>Requesting a new feature requires a donation. The minimum amount for a feature is â‚¬150,- but it may be altered.*
    </p>
    <form action="{% url 'post_feature_request' %}" method="POST">
      {% csrf_token %}
      <div class="radio-group">
        <label for="finder_app" class="radio-container">
          Finder App
          <input type="radio" id="finder_app" name="app_type" value="finder_app" checked>
          <span class="checkbox"></span>
        </label>
        <label for="recipe_community" class="radio-container">
          Recipe Community
          <input type="radio" id="recipe_community" name="app_type" value="recipe_community">
          <span class="checkbox"></span>
        </label>
      </div>
      <div class="input-field">
        <input type="text" name="title" placeholder="Title / summary">
        <span class="counter">0/75</span>
      </div>
      <div class="input-area">
        <textarea name="description" cols="30" rows="10" placeholder="Feature description"></textarea>
        <span class="counter">0/75</span>
      </div>
      <button type="submit" class="btn no-stretch">Submit</button>
    </form>
    <p class="footnote">* Depends on the estimated development time.</p>
  </div>
</div>

<div id="new_bug_report" class="modal-container">
  <div class="modal">
    <img src="{% static 'img/clear.svg' %}" alt="close" class="close-modal" onclick="TE.closeModal('new_bug_report')">
    <h3>Report a new bug</h3>
    <p>Reporting a bug is free of charge! Try to be as descriptive as possible.
    </p>
    <form action="{% url 'post_bug_report' %}" method="POST">
      {% csrf_token %}
      <div class="radio-group">
        <label for="finder_app" class="radio-container">
          Finder App
          <input type="radio" id="finder_app" name="app_type" value="finder_app" checked>
          <span class="checkbox"></span>
        </label>
        <label for="recipe_community" class="radio-container">
          Recipe Community
          <input type="radio" id="recipe_community" name="app_type" value="recipe_community">
          <span class="checkbox"></span>
        </label>
      </div>
      <div class="input-field">
        <input type="text" name="title" placeholder="Title / summary">
        <span class="counter">0/75</span>
      </div>
      <div class="input-area">
        <textarea name="description" cols="30" rows="10" placeholder="Bug description"></textarea>
        <span class="counter">0/75</span>
      </div>
      <button type="submit" class="btn no-stretch">Submit</button>
    </form>
  </div>
</div>

{% endblock %}